var gameLogic;!function(a){function b(){return[["","","","","","","",""],["","","","","","","",""],["","","","","","","",""]]}function c(){return{count:0,phase:1,phaseLastTime:1,alreadyMills:[]}}function d(){var a=[];return a[0]=c(),a[1]=c(),a}function e(a,b){for(var c=0;c<b.length;c++)if(a.sort().toString()===b[c].sort().toString())return!0;return!1}function f(a,b,c){var d,f,g={};for(f=1;7>=f;f+=2)if(a[0][f]===c&&a[1][f]===c&&a[2][f]===c&&!e([[0,f],[1,f],[2,f]],b))return g.player=c,g.mills=[[0,f],[1,f],[2,f]],g;for(d=0;2>=d;d++)for(f=0;6>=f;f+=2)if(a[d][f]===c&&a[d][f+1]===c&&a[d][(f+2)%8]===c&&!e([[d,f],[d,f+1],[d,(f+2)%8]],b))return g.player=c,g.mills=[[d,f],[d,f+1],[d,(f+2)%8]],g;return g.player="N",g.mills=[],g}function g(a,b){var c=a,d=b;if(c[0]===d[0]){if(1===Math.abs(c[1]-d[1])||7===Math.abs(c[1]-d[1]))return!0}else if(c[1]===d[1]&&c[1]%2===1&&1===Math.abs(c[0]-d[0]))return!0;return!1}function h(a,b){var c=0,d=0,e=0;for(c=0;2>=c;c++)for(d=0;7>=d;d++)0===b&&"W"===a[c][d]&&e++,1===b&&"B"===a[c][d]&&e++;return e}function i(a,b){var c,d,e=[],f=1;for(c=0;2>=c;c++)for(d=0;7>=d;d++)""===a[c][d]&&g([c,d],b)&&(f=0,e.push(c),e.push(d));return 1===f?"N":e}function j(a,b){var c,d,e=0===b?"W":"B";for(c=0;2>=c;c++)for(d=0;7>=d;d++)if(a[c][d]===e&&"N"!==i(a,[c,d]))return!0;return!1}function k(a,b){var c=b[0].phase,d=b[1].phase;return 1!==c&&h(a,0)<3?"B":1!==d&&h(a,1)<3?"W":2!==c||j(a,0)?2!==d||j(a,1)?"N":"W":"B"}function l(a,b,c){var d=b[c].phase,e=h(a,c),g=0===c?"W":"B",i=f(a,b[c].alreadyMills,g);return i.player===g?4:d=9===b[c].count?2:3===e&&2===b[c].phaseLastTime?3:4===d?b[c].phaseLastTime:d}function m(a,b,c){for(var d=0===b?"W":"B",e=0;e<c.length;e++)if(a[c[e][0]][c[e][1]]!==d)return!1;return!0}function n(a,b,c){for(var d=0;d<b[c].alreadyMills.length;d++)if(!m(a,c,b[c].alreadyMills[d]))return d;return-1}function o(a,b,c){var d=0===c?"W":"B",e=b[c].phase,g=f(a,b[c].alreadyMills,d),i=angular.copy(b[c].alreadyMills),j=angular.copy(b[1-c].alreadyMills),k=n(a,b,c),m=n(a,b,1-c),o=angular.copy(b);4!==e&&(o[c].count=o[c].count+1);var p=l(a,o,c),q=h(a,1-c);return-1!==k&&i.splice(k,1),-1!==m&&j.splice(m,1),g.player===d&&i.push(g.mills),3===q&&2===b[1-c].phaseLastTime&&(o[1-c].phase=3,o[1-c].phaseLastTime=2),o[c].phase=p,o[c].phaseLastTime=e,o[c].alreadyMills=i,o[1-c].alreadyMills=j,o}function p(a,c,e,h,i,j,l){void 0===a&&(a=b()),void 0===c&&(c=d());var m,n,p=0===l?"W":"B",q=c[l].phase,r=k(a,c),s=angular.copy(a);if("N"!==r)throw new Error("Can only make a move if the game is not over!");if(4!==q&&""!==a[e][h])throw new Error("That place has been occupied!");if(1===c[l].phase)s[e][h]=p;else if(2===c[l].phase||3===c[l].phase){if(!g([e,h],[i,j])&&2===c[l].phase)throw new Error("You can only move to an adjacent place!");if(a[i][j]!==p)throw new Error("You can only move the your man!");s[e][h]=p,s[i][j]="",r=k(s,c),"N"!==r&&(m={endMatch:{endMatchScores:"B"===r?[0,1]:[1,0]}})}else if(4===c[l].phase){var t="B"===p?"W":"B";if(a[i][j]!==t)throw new Error("Please choose a man of the enemy to remove!");s[i][j]="",r=k(s,c),"N"!==r&&(m={endMatch:{endMatchScores:"B"===r?[0,1]:[1,0]}})}return"N"===r&&(m=f(s,c[l].alreadyMills,p).player===p?{setTurn:{turnIndex:l}}:{setTurn:{turnIndex:1-l}}),n=o(s,c,l),[m,{set:{key:"board",value:s}},{set:{key:"playerStates",value:n}},{set:{key:"delta",value:{destination:[e,h],origin:[i,j]}}}]}function q(a,b,c){var d,e,f,g,h=[],i=b[c].phase;if(1===i||4===i)for(d=0;2>=d;d++)for(e=0;7>=e;e++)try{h.push(1===i?p(a,b,d,e,null,null,c):p(a,b,null,null,d,e,c))}catch(j){}if(2===i||3===i)for(d=0;2>=d;d++)for(e=0;7>=e;e++)for(f=0;2>=f;f++)for(g=0;7>=g;g++)try{h.push(p(a,b,d,e,f,g,c))}catch(j){}return h}function r(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[3].set.value,f=e.destination[0],g=e.destination[1],h=e.origin[0],i=e.origin[1],j=d.board,k=d.playerStates,l=p(j,k,f,g,h,i,c);if(!angular.equals(b,l))return!1}catch(m){return!1}return!0}a.getInitialBoard=b,a.getInitialStates=d,a.createMove=p,a.getAllPossibleMove=q,a.isMoveOk=r}(gameLogic||(gameLogic={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).factory("gameLogic",function(){return{getInitialBoard:gameLogic.getInitialBoard,getInitialStates:gameLogic.getInitialStates,getAllPossibleMove:gameLogic.getAllPossibleMove,createMove:gameLogic.createMove,isMoveOk:gameLogic.isMoveOk}});var turnIndex,state=null,animationEnded=!1,isComputerTurn=!1,isYourTurn,waitPiece=!1,lastPlacement={},gameArea,rowsNum=7,colsNum=7,draggingStartedRowCol={row:-1,col:-1},draggingStartRaw=null,draggingPiece=null,nextZIndex=61,rowtmp,coltmp,game;!function(a){function b(){$rootScope.$apply(function(){log.info("Animation ended"),animationEnded=!0,isComputerTurn&&d()})}function c(){resizeGameAreaService.setWidthToHeight(.866525424),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",b,!1),document.addEventListener("webkitAnimationEnd",b,!1),document.addEventListener("oanimationend",b,!1),dragAndDropService.addDragListener("gameArea",f)}function d(){gameService.makeMove(aiService.createComputerMove(state.board,state.playerStates,turnIndex,{millisecondsLimit:1e3}))}function e(a){animationEnded=!1,state=a.stateAfterMove,void 0===state.board&&(state.board=gameLogic.getInitialBoard()),void 0===state.playerStates&&(state.playerStates=gameLogic.getInitialStates()),isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,turnIndex=a.turnIndexAfterMove,isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&(isYourTurn=!1,$timeout(d,1e3))}function f(a,b,c){if(gameArea=document.getElementById("gameArea"),void 0!==state.playerStates&&-1!==turnIndex){var d=state.playerStates[turnIndex].phase,e=b-gameArea.offsetLeft,f=c-gameArea.offsetTop;if(0>e||0>f||e>=gameArea.clientWidth||f>=gameArea.clientHeight){if(!draggingPiece)return;var j=i();h({top:f-j.height/2,left:e-j.width/2})}else{coltmp=Math.floor(colsNum*e/gameArea.clientWidth),rowtmp=Math.floor(rowsNum*f/gameArea.clientHeight);var l,m;if(0===coltmp&&0===rowtmp?(l=0,m=0):3===coltmp&&0===rowtmp?(l=1,m=0):6===coltmp&&0===rowtmp?(l=2,m=0):6===coltmp&&3===rowtmp?(l=3,m=0):6===coltmp&&6===rowtmp?(l=4,m=0):3===coltmp&&6===rowtmp?(l=5,m=0):0===coltmp&&6===rowtmp?(l=6,m=0):0===coltmp&&3===rowtmp?(l=7,m=0):1===coltmp&&1===rowtmp?(l=0,m=1):3===coltmp&&1===rowtmp?(l=1,m=1):5===coltmp&&1===rowtmp?(l=2,m=1):5===coltmp&&3===rowtmp?(l=3,m=1):5===coltmp&&5===rowtmp?(l=4,m=1):3===coltmp&&5===rowtmp?(l=5,m=1):1===coltmp&&5===rowtmp?(l=6,m=1):1===coltmp&&3===rowtmp?(l=7,m=1):2===coltmp&&2===rowtmp?(l=0,m=2):3===coltmp&&2===rowtmp?(l=1,m=2):4===coltmp&&2===rowtmp?(l=2,m=2):4===coltmp&&3===rowtmp?(l=3,m=2):4===coltmp&&4===rowtmp?(l=4,m=2):3===coltmp&&4===rowtmp?(l=5,m=2):2===coltmp&&4===rowtmp?(l=6,m=2):2===coltmp&&3===rowtmp&&(l=7,m=2),"touchstart"===a&&draggingStartedRowCol.row<0&&draggingStartedRowCol.col<0){if(2===d||3===d){if(draggingStartRaw={row:rowtmp,col:coltmp},draggingStartedRowCol={row:m,col:l},draggingPiece=document.getElementById("e2e_test_img_"+draggingStartedRowCol.row+"x"+draggingStartedRowCol.col),null!==draggingPiece&&(draggingPiece.style["z-index"]=++nextZIndex),void 0===m||void 0===l)return void g();if(0>m||m>2||0>l||l>7)return void g();var n=0===turnIndex?"W":"B";if(state.board[m][l]!==n)return void g()}(4===d||1===d)&&$rootScope.$apply(function(){if(isYourTurn)try{var a=state.playerStates[turnIndex].phase;if(1===a)var b=gameLogic.createMove(state.board,state.playerStates,m,l,null,null,turnIndex);else if(4===a)var b=gameLogic.createMove(state.board,state.playerStates,null,null,m,l,turnIndex);gameService.makeMove(b)}catch(c){return void console.log(["Can't place piece:",m])}})}if(!draggingPiece)return;if("touchend"===a){var o=draggingStartedRowCol,p={row:m,col:l},d=state.playerStates[turnIndex].phase;(2===d||3===d)&&k(o,p)}else{console.log(gameArea.clientWidth);var j=i();console.log("size.width: "+j.width/2+"size.height"+j.height/2+"x"+e+"y"+f),h({top:f-j.height/2,left:e-j.width/2})}}("touchend"===a||"touchcancel"===a||"touchleave"===a)&&g()}}function g(){var a=j(rowtmp,coltmp);h(a),null!==draggingPiece&&(draggingPiece.removeAttribute("style"),draggingPiece=null),draggingStartedRowCol={row:-1,col:-1},draggingPiece=null}function h(a){var b=j(draggingStartRaw.row,draggingStartRaw.col);null!==draggingPiece&&(draggingPiece.style.left=a.left-b.left+.03*gameArea.clientWidth+"px",draggingPiece.style.top=a.top-b.top+.03*gameArea.clientHeight+"px")}function i(){return{width:gameArea.clientWidth/colsNum,height:gameArea.clientHeight/rowsNum}}function j(a,b){var c=i();return{top:a*c.height,left:b*c.width}}function k(a,b){$rootScope.$apply(function(){if(console.log(["Clicked on cell:",a.row,a.col]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(!isYourTurn){void 0===waitPiece&&(waitPiece=!1),void 0===lastPlacement&&(lastPlacement={});try{var c=state.playerStates[turnIndex].phase;if(2===c||3===c){var d=gameLogic.createMove(state.board,state.playerStates,b.row,b.col,a.row,a.col,turnIndex);gameService.makeMove(d),console.log(draggingPiece)}}catch(e){return void console.log(["Can't move piece:",a.row,a.col])}}})}function l(a,b){var c=state.board[a][b];return""!==c}function m(a,b){if(void 0===state.playerStates||-1===turnIndex)return!1;var c=0===turnIndex?"W":"B",d=turnIndex,e=state.board,f=state.playerStates[turnIndex].phase;if(1===f)return!1;if(2===f||3===f)return e[a][b]===c?!0:!1;if(4===f){var g=1===d?"W":"B";return e[a][b]===g?!0:!1}}function n(a,b){var c=state.board[a][b];return"W"===c?"imgs/white.png":"B"===c?"imgs/black.png":""}function o(a,b){var c=!animationEnded&&void 0!==state.delta&&state.delta.destination[0]===a&&state.delta.destination[1]===b;return c}function p(a,b){return!animationEnded&&void 0!==state.delta&&state.delta.origin[0]===a&&state.delta.origin[1]===b}a.init=c,a.shouldShowImage=l,a.shouldHighLight=m,a.getImageSrc=n,a.shouldEnLar=o,a.shouldFade=p}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_NNM:"Rules of Nine Men's Morris",RULES_SLIDE1:"Nine Men's Morris has 3 phases, and each has different rules",RULES_SLIDE2:"Phase1: Placing men on vacant points",RULES_SLIDE3:"Phase2: Moving men to adjacent points",RULES_SLIDE4:"Phase3: Moving men to any vacant point when a player has been reduced to three men",RULES_SLIDE5:"Players try to form 'mills'â€” three of their own men lined horizontally or vertically",RULES_SLIDE6:"When a 'mills' is formed you are allowed to remove an enemy's man.",RULES_SLIDE7:"When one player loses has less than 3 players or has no place to move.",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a,b,f,g){return alphaBetaService.alphaBetaDecision([null,{set:{key:"board",value:a}},{set:{key:"playerStates",value:b}}],f,e,d,"?debug"===window.location.search?c:null,g)}function c(a){return"\n"+a[1].set.value.join("\n")+"\n"}function d(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 4===a[2].set.value[0].phase?Number.POSITIVE_INFINITY/2:4===a[2].set.value[1].phase?Number.NEGATIVE_INFINITY/2:1e12*a[2].set.value[0].alreadyMills.length-1e12*a[2].set.value[1].alreadyMills.length}function e(a,b){return gameLogic.getAllPossibleMove(a[1].set.value,a[2].set.value,b)}a.createComputerMove=b}(aiService||(aiService={})),angular.module("myApp").factory("aiService",function(){return{createComputerMove:aiService.createComputerMove}});
//# sourceMappingURL=everything.min.js.map